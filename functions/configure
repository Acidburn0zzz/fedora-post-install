#!/bin/bash

dir="$(dirname "$0")"

GSETTINGS="$dir/data/gsettings.list"

# Automatically set preferred gsettings keys as outlined in the 'gsettings.list' file
function preferences {
	echo_message info 'Setting preferred application-specific & desktop settings...'
	while IFS= read line
	do
		gsettings set $line
	done < "$GSETTINGS"
	# Done
	echo_message success 'Done.'
	whiptail --title "Finished" --msgbox "Settings changed successfully." 8 78
	configure
}

# Put SELinux in permissive mode
function selinux {
	echo_message info 'Configuring SELinux to ryn in permissive mode...'
	echo_message warning 'Requires root privileges:'  
	elevate_privilege "sed --in-place 's/SELINUX=.*$/SELINUX=permissive/g' /etc/selinux/config"
	echo_message success 'Done.'
	# Done
	whiptail --title "Finished" --msgbox "Settings changed successfully." 8 78
	configure
}

# Configure System
function configure {
	eval `resize`
	CONF=$(whiptail \
		--notags \
		--title "Configure System" \
		--menu "\nWhat would you like to do?" \
		--cancel-button "Go Back" \
		$LINES $COLUMNS $(( $LINES - 12 )) \
		preferences	 'Set preferred application-specific settings' \
		selinux		 'Put SELinux in permissive mode' \
		3>&1 1>&2 2>&3)
	 
	exitstatus=$?
	if [ $exitstatus = 0 ]; then
		$CONF
	else
		main
	fi
}