#!/bin/bash

# Install RPM Fusion
function repositories {
	eval `resize` 
	EXITSTATUS=$?
	if [ $EXITSTATUS = 0 ]; then
		status="0"
		while [ "$status" -eq 0 ]; do
			REPOS=$(whiptail \
				--title "Third-Party Repositories" \
				--radiolist \
				"Which third-party repositories would you like to add?"\
				--ok-button "Add" \
				--cancel-button "Go Back" \
				$LINES $COLUMNS $(( $LINES - 12 )) \
				"rpmfusion_free"		"RPM Fusion (Free)" ON \
				"rpmfusion_nonfree"		"RPM Fusion (Non-free)" OFF \
				3>&1 1>&2 2>&3)

			case "${REPOS}" in
			# RPM Fusion Free
			rpmfusion_free)
				# Check
				if [ -e /etc/yum.repos.d/rpmfusion-free.repo ]; then
					echo_message info 'Repository already added.'
					whiptail --msgbox "RPM Fusion (Free) repository is already added." 8 78
					repositories
				else
					# Add repository
					echo_message info 'Adding repository...'
					elevate_privilege "dnf install https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm"
					echo_message success 'Done.'
					whiptail --title "Finished" --msgbox "RPM Fusion (Free) repository has been added." 8 78
					repositories
				fi
			;;
			# RPM Fusion Non-free
			rpmfusion_nonfree)
				# Check
				if [ -e /etc/yum.repos.d/rpmfusion-nonfree.repo ]; then
					echo_message info 'Repository already added.'
					whiptail --msgbox "RPM Fusion (Non-free) repository is already added." 8 78
					repositories
				else
					# Add repository
					echo_message info 'Adding repository...'
					elevate_privilege "dnf install https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm"
					echo_message success 'Done.'
					whiptail --title "Finished" --msgbox "RPM Fusion (Non-free) repository has been added." 8 78
					repositories
				fi
			;;
			# Go Back
			*) status=1
				main
			;;
			esac
		done
	else
		main
	fi
}